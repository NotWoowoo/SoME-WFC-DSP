<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="dist/main.css" rel="stylesheet">
    <title>Audio Programming Tutorial</title>
</head>
<body>
    <div class="bg-slate-200 py-2 shadow-sm"> 
        <h1 class="text-center text-3xl">DSP For Audio Programming</h1>
        <h3 class="text-center text-xl">An Interactive Guide by Sean McGoff and notWoowoo</h3>
    </div>
    

    <p class="text-center my-2" >
        <button onclick="toggleEverything(this)" class="bg-slate-200 hover:bg-yellow-100 rounded-md px-2 py-1">SHOW Everything</button>
    </p>

    <!--ABOUT DROPDOWN-->
    <div class="dropdown root-dropdown">
        <h3 class="section-title">&#8594; <b>About</b></h3>
        <div class="section-body">
            <p>This website is designed to teach enough digital signal processing (DSP) in order for you to be able to start your journey into programming audio software. Whether you want to create VST plugins for digital audio workstations, add complex audio to your website / application / game, or just want to pick up a new skill, this free course will give you a great foundation in DSP.</p>
            <p>For those interested in what technology powers this site, we are using Github Pages to host the website, Tailwind CSS to style the pages, Desmos' API to create the interactive visualizations, and C++ (compiled into web assembly) for the editing environments. The public GitHub repository can be found 
            <a href=”https://github.com/NotWoowoo/SoME-WFC-DSP”>here</a>.</p>
        </div>
        <div class="dropdown child-dropdown">
            <p class="section-title">&#8594; How to use this website</p>
            <div class="section-body">
                <p>This website is organized into a tree of dropdown menus, each expanding on subjects in higher level dropdowns (such as this "How to use this website" dropdown).</p>
                <p>To get the most out of this site, it's recommended to start by reading everything (with "Expand Everything" if you prefer). Once you have gone through the information once, specific information is easily accessable by navigating the dropdowns.</p>
            </div>
        </div>
    </div>

    <!--SECTION 1 DROPDOWN-->
    <div class="dropdown root-dropdown">
        <h3 class="section-title">&#8594; <b>Section 1:</b> What is digital audio, really?</h3>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; The Wide World of DSP</h3>
            <div class="section-body">
                <p>It seems pretty reasonable that in order to understand how to process digital audio, you must first understand what digital audio is. As you'll soon find out, digital audio is merely a category of a larger kind of digital data called signals. Signals are that new beat you spent all night working on, the readings from an EKG sensor, seismic data from geophones, and even images of cats on the internet! The point is that while this course is specifically geared towards digital audio in particular, that is far from the only application of this course's material. If you want more information on DSP's applications in image processing and data compression, I'd recommend looking through Chapters 23 to 27 of <a href="http://www.dspguide.com/">Dr. Steven W. Smith's “The Scientist and Engineer's Guide to Digital Signal Processing”</a>
                </p> 
            </div>
        </div>
        
        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; Analog vs Digital</h3>
            <div class="section-body">
                <p>What even is analog? Why does that older fellow in the music store keep insisting that his dusty old analog synthesizers sound so much warmer and natural than the modern digital trash? Does he even know what analog means? Since the D in DSP stands for “digital”, it only makes sense to start by explaining what that means. Before computers became the standard for audio processing, the main option for synthesizing and processing audio were dedicated circuits. The sound wave in these circuits is transferred through fluctuations in voltage over time. What makes this method of sound synthesis and processing analog is the continuity of the signal. In other words, if you attached a polygraph machine to the source of an analog signal, and traced your finger across the resulting curve, you would never have to pick up your finger. To answer the question about the older fellow in the music store, there is some truth to his claim that analog synths can sound more natural. Electronic components like resistors and capacitors are prone to minor fluctuations in their current, voltage, and resistance, which results in a less “perfect” signal.</p>
                <div class="flex justify-center">
                    <img src="img/polygraph.jpeg">
                </div>
                <p>In comparison, digital signals are discrete. Rather than a continuous curve, the polygraph would show a set of evenly spaced points for a digital sound source. This method works well for computers as you can store a digital signal pretty efficiently on a hard drive, while you would need an infinite amount of storage space to store an analog one. Since our application is audio programming, we will only focus on digital signals from now on.</p>
            </div>
        </div>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; Signals, Samples, Amplitude, and Sample Rate</h3>
            <div class="section-body">
                <p>So, what is this signal? A signal is a list of numbers over a fixed rate of time. In the case of audio, the numbers are known as the “samples” and they measure the “amplitude” at each sample's point in time. Typically, amplitude is denoted as a decimal value between -1 and 1. The way I like to think about amplitude is by imagining the cone of a speaker. An amplitude of 1 means the cone is pushed all the way out, and -1 is pulled all the way in. From the rapid movement of the cone's position over time, you get sound. The fixed rate of time is known as the “sample rate”, which is commonly measured in samples per second. The most common sample rate in music is 44.1khz, or 44,100 samples per second.</p>
                <div class="flex justify-center">
                    <div id="sampleRateDesmosCalc" style="width: 600px; height: 400px;"></div>
                </div>
            </div>
        </div>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; Bit Depth and the "Retro" Sound</h3>
            <div class="section-body">
                <p>Computers, and especially older ones, have a hard time accurately storing non-whole numbers. Since a digital audio signal's values are non-whole numbers by nature, that creates a limitation on how precise each value can be. In DSP, this precision is known as the “Bit Depth” of a digital signal. The bit depth is merely the amount of bits required to hold said number (<a href="https://web.stanford.edu/class/cs101/bits-bytes.html">Here</a> is a good resource to understanding bits and binary numbers). Most modern digital audio workstations use a standard bit depth of 32 bits, meaning that there are 2<sup>32</sup> possible values a sample can have between -1 and 1. Converting to lower bit depths forces samples' amplitudes to be quantized (snapped to the closest intermediate value). The effect of this is a noiser audio signal that sounds characteristically "retro" (since old hardware had lower bit depths).</p>
                <p>[two files to compare of different bit depths maybe]</p>
                <div class="flex justify-center">
                    <div id="bitDepthDesmosCalc" style="width: 600px; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>


    <!--SECTION 2 DROPDOWN-->
    <div class="dropdown root-dropdown">
        <h3 class="section-title">&#8594; <b>Section 2:</b> Frequency</h3>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; What is Frequency?</h3>
            <div class="section-body">
                <p>Until now, we have only been looking at digital audio in the time domain (where time is the horizontal axis of the graph), but a great deal of information can be dissected from the frequency domain as well. To introduce frequency, let's think about this cat spinning on a record player.</p>
                <div class="flex justify-center">
                    <img src="img/cat-spin.gif">
                </div>
                <p>We can measure the “frequency” by finding how many times the cat makes a full rotation per unit time. The standard unit for frequency is the hertz (hz), or cycles/second. Since the cat is spinning on a 33 rpm (revolutions per minute) record, we can find the revolutions per second by dividing 33 by 60. Therefore, we can find that the cat is spinning at a frequency of 0.55 hz, or roughly one full rotation for every 1.8 seconds.</p>
                <p>The best equivalent to this spinning cat in the world of DSP is the sine wave. Much like the GIF of the cat, sine waves are periodic, or repeat infinitely in a very predictable manner. Because of this property, we can measure a sine wave's frequency in a similar way. The frequency of a sine wave is 1 divided by the “period” of the wave, or the time it takes to complete one cycle.</p>
                <div class="flex justify-center">
                    <div id="frequencyDesmosCalc" style="width: 600px; height: 400px;"></div>
                </div>
            </div>
        </div>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; Everything is Sine Waves!</h3>
            <div class="section-body">
                <p>For those who have seen less idealistic audio signals, you'll know that you'll very rarely have something as clean as a sine wave. For these cases, there's no way to measure frequency in the same way we did the perfect sine wave. The key insight comes when we start thinking of signals of having <i>multiple</i> frequencies instead. This idea comes from a subject in math known as Fourier Analysis, named after French mathematician and physicist Joseph Fourier. What Fourier tells us is that any signal (analog or digital) can be decomposed into a series (sum) of sinusoidal waves of ascending frequency. The first term will be the “DC component”, or a flat line that represents the average amplitude of the signal, and each succeeding term is a sinusoidal wave of a certain amplitude and phase (starting position in the cycle). In some cases, this sum can be infinite, but for digital signals, there is a finite limit (this idea will be explored when we talk about the Nyquist Sampling Theorem). What the frequency domain shows us is the amplitude of a signal as a function of the corresponding sinusoidal component at each frequency. Since saying “the corresponding sinusoidal components at each frequency” is a mouthful, the more common term is “the frequencies of the signal”. If you got all of that, great job! Take a breath knowing that you now understand the (rather dated) meme below.</p>
                <div class="flex justify-center">
                    <img src="img/fourier-meme.png">
                </div>
            </div>
        </div>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; The Nyquist Sampling Theorem</h3>
            <div class="section-body">
                <p>The "Nyquist frequency" is the highest possible frequency that can be represented by a signal, and it's exactly half of the sample rate.</p>
                <p>Since human hearing goes up to 20,000 hz or 20kHz, the sample rate of most audio you listen to is around 40kHz.</p>
            </div>
        </div>

        <div class="dropdown child-dropdown">
            <h3 class="section-title">&#8594; <i>Try it Yourself:</i> sine waves and other waves.</h3>
            <p>wip</p>
        </div>
    </div>



    <p id="shared-msg" align=center style="display:none;"><b>Playground's Code Was Supplied By Shared Link!</b></p>

    <!--CUSTOM EDITOR DROPDOWN-->
    <div class="dropdown root-dropdown" id="playground-dropdown">
        <h3 class="section-title">&#8594; <b>PLAYGROUND</b></h3>
        <div class="section-body">
            <div class="flex">
                <div id="editor" class="w-1/2 h-80"></div>
                <div class="w-1/2 h-80">
                    <div style="height: 10%; background-color: rgb(20, 20, 20);" class="w-full text-center text-white text-xl">
                        Time Domain
                    </div>
                    <canvas style="height: 40%" id="playgroundOsc" class="w-full"></canvas>
                    <div style="height: 10%; background-color: rgb(20, 20, 20);" class="w-full text-center text-white text-xl">
                        Frequency Domain
                    </div>
                    <canvas style="height: 40%" id="playgroundFFT" class="w-full"></canvas>
                </div>
            </div>
            <button onclick="runUserCode(false)" class="bg-slate-200 hover:bg-yellow-100 rounded-md px-2 py-1 mb-2">Run</button>
            <button onclick="runUserCode(true)" class="bg-slate-200 hover:bg-yellow-100 rounded-md px-2 py-1 mb-2" title="Save the code for your next visit to this site">Run + Save</button>
            <button onclick="closeDSP()" class="bg-slate-200 hover:bg-yellow-100 rounded-md px-2 py-1 mb-2">Stop</button>
            <button onclick="shareUserCode()" class="bg-slate-200 hover:bg-yellow-100 rounded-md px-2 py-1 mb-2">Share</button>
        </div>
    </div>

    <!-- I don't think we'll be needing this
    <div class="text-center">
        <h6 class="mt-2">interactive demo (WIP)</h6>
        <button onclick="onTestButtonClicked()" class="bg-slate-200 hover:bg-yellow-100 rounded-md px-2 py-1 mb-2">Run Demo</button>
    </div>
    -->
    

    <!-- PLAN (so far)...
        PROGRAMMING: sine waves & other waves
        user has task to make a sine wave, specifics tbd (but include some basics about pitch and multiplying the input)??
        user can try adding multiple sine waves.

        Another common type of wave: saw wave
        first user makes saw wave via mod func,
        then user does the same via adding sine waves according to the fact that each harmonic in a saw wave is sin(nx)/n.

        Same with square waves
        user can try subtracting a saw wave one octave higher from the original saw wave
        OR can add the harmonics manually

        TODO:
        noise and (its colors)
        filtering
        modulation of signals (pitch and vol LFOs and FM/AM/PM synthesis)
        Basic programmatic sequencing
    -->

    <!--<script src="js/main.js"></script>-->
    <script src="js/dsp.js"></script>
    <script src="js/scopes.js"></script>

    <!--Dropdown script-->
    <script>
    //NOTE: it could be convenient to cache the status of which dropdowns are visible for future visits
    function toggleDropdown(e){
        Array.from(e.children).forEach((c,i) => {
            if(i===0) return
            if(c.dropdown_originalDisplay === undefined) c.dropdown_originalDisplay = c.style.display //janky?
            c.style.display = c.style.display === 'none' ? c.dropdown_originalDisplay : 'none'
            //TODO: Add switching arrow from → to ↓ on expand and vice versa
        })
    }

    var toggleEverythingDropped = false;
    function toggleEverything(eBtn){
        Array.from(document.getElementsByClassName("dropdown")).forEach(e => {
            Array.from(e.children).forEach((c,i) => {
                if(i===0) return
                 c.style.display = toggleEverythingDropped ? 'none' : c.dropdown_originalDisplay
            })
        })
        toggleEverythingDropped = !toggleEverythingDropped
        eBtn.innerHTML = toggleEverythingDropped ? 'HIDE Everything' : 'SHOW Everything'
    }

    Array.from(document.getElementsByClassName("dropdown")).forEach(e => {
        e.getElementsByClassName('section-title')[0].onclick = () => toggleDropdown(e)
        toggleDropdown(e)
    })
    </script>

    <!-- Manage shared or saved code BEFORE initializing the editor(b/c the editor takes a second to load) -->
    <script src="./js/lz-string.min.js" type="text/javascript" charset="utf-8"></script>
    <script>
    var code = (new URL(window.location)).searchParams.get('code')
        if(code !== null){
            document.getElementById('shared-msg').style.display = ''
            code = LZString.decompressFromBase64(code)
            toggleDropdown(document.getElementById('playground-dropdown')) //slightly janky b/c toggle expects that all dropdowns are initially hidden
        }else
            code = (localStorage.getItem('code') === null) ? `//phasey saw!
let f = 110 //frequency
let v = 0 //output sample
let h = 50 //number of harmonics
for(let i = 1; i < h; i+=1)
    v += .15*Math.sin(2*Math.PI*i/50.0 + time)*Math.sin(time*Math.PI*f*i)/i
return v` : localStorage.getItem('code')
    </script>

    <script src="https://www.desmos.com/api/v1.7/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
    <script src="js/calculator.js"></script>

    <script src="./js/ace/src-min/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="./js/ace/src-min/theme-twilight.js" type="text/javascript" charset="utf-8"></script>
    <script src="./js/ace/src-min/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
    <!--Editor script-->
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/twilight");
        var JavaScriptMode = ace.require("ace/mode/javascript").Mode;
        editor.session.setMode(new JavaScriptMode());
        editor.setValue(code)

        const fftCanvas = document.getElementById("playgroundFFT")
        const oscCanvas = document.getElementById("playgroundOsc")
        clearScopes(oscCanvas, fftCanvas)

        function runUserCode(save){
            setDSPsimple(editor.getValue())
            //also save it
            if(save)
                localStorage.setItem('code', editor.getValue())
        }

        function shareUserCode(){
            alert((new URL(window.location)).host + '?code=' + LZString.compressToBase64(editor.getValue()))
        }
    </script>
</body>
</html>
